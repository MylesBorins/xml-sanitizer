{"version":3,"file":"munge-mocks.js","sourceRoot":"","sources":["../../src/munge-mocks.ts"],"names":[],"mappings":";;;AAAA,mCAAkC;AAClC,+BAA0C;AAC1C,4EAAsE;AACtE,6BAAmC;AAEnC,8DAA8D;AAC9D,wDAAwD;AAEjD,MAAM,UAAU,GAAG,CACxB,UAA+B,EAC/B,GAAW,EAC4B,EAAE;IACzC,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;IACjC,KAAK,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;QAChD,MAAM,CAAC,GACL,CAAC,IAAI,OAAO,CAAC,KAAK,QAAQ,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/C,CAAC;YACH,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,CAAA;QAClB,IAAI,IAAA,kBAAS,EAAC,CAAC,CAAC,EAAE,CAAC;YACjB,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;YACZ,qBAAqB;YACrB,IAAI,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;gBAC1B,oBAAoB;gBACpB,MAAM,IAAI,GAAG,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;gBACxC,IAAI,CAAC,CAAC,IAAI,IAAI,UAAU,CAAC,EAAE,CAAC;oBAC1B,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;gBACjB,CAAC;YACH,CAAC;iBAAM,CAAC;gBACN,MAAM,QAAQ,GAAG,QAAQ,CAAC,EAAE,CAAA;gBAC5B,IAAI,CAAC,CAAC,QAAQ,IAAI,UAAU,CAAC,EAAE,CAAC;oBAC9B,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAA;gBACrB,CAAC;YACH,CAAC;QACH,CAAC;aAAM,IAAI,4BAA4B,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;YAChD,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;QACd,CAAC;aAAM,IAAI,IAAA,uCAAiB,EAAC,CAAC,CAAC,IAAI,IAAA,iBAAU,EAAC,CAAC,CAAC,EAAE,CAAC;YACjD,KAAK,CAAC,MAAM,CAAC,IAAA,mBAAa,EAAC,IAAA,cAAO,EAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;QACnD,CAAC;aAAM,CAAC;YACN,wBAAwB;YACxB,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;QACd,CAAC;IACH,CAAC;IACD,OAAO,KAAK,CAAA;AACd,CAAC,CAAA;AAnCY,QAAA,UAAU,cAmCtB","sourcesContent":["import { isBuiltin } from 'module'\nimport { isAbsolute, resolve } from 'path'\nimport { isRelativeRequire } from 'resolve-import/is-relative-require'\nimport { pathToFileURL } from 'url'\n\n// turn all the mocks we get into either the exports provided,\n// if it's an object, or { default: <value> } otherwise.\n\nexport const mungeMocks = (\n  mocksInput: Record<string, any>,\n  dir: string,\n): { [k: string]: { [j: string]: any } } => {\n  const mocks = Object.create(null)\n  for (const [k, v] of Object.entries(mocksInput)) {\n    const m =\n      v && typeof v === 'object' && !Array.isArray(v) ?\n        v\n      : { default: v }\n    if (isBuiltin(k)) {\n      mocks[k] = m\n      /* c8 ignore start */\n      if (k.startsWith('node:')) {\n        /* c8 ignore stop */\n        const bare = k.substring('node:'.length)\n        if (!(bare in mocksInput)) {\n          mocks[bare] = m\n        }\n      } else {\n        const prefixed = `node:${k}`\n        if (!(prefixed in mocksInput)) {\n          mocks[prefixed] = m\n        }\n      }\n    } else if (/^(file:\\/\\/\\/|https?:\\/\\/)/.test(k)) {\n      mocks[k] = m\n    } else if (isRelativeRequire(k) || isAbsolute(k)) {\n      mocks[String(pathToFileURL(resolve(dir, k)))] = m\n    } else {\n      // absolute package name\n      mocks[k] = m\n    }\n  }\n  return mocks\n}\n"]}